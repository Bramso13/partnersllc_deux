# Story 1.4: Health Check Endpoint and Basic Deployment

## Status

Ready for Review

## Story

**As a** developer,
**I want** a health check API endpoint that verifies database connectivity and returns system status,
**so that** we can confirm the application is deployable and infrastructure is working correctly.

## Acceptance Criteria

1. API route created at `/api/health` returning JSON status response
2. Health check verifies Supabase database connection by executing simple query (`SELECT 1`)
3. Response includes: `{ status: "healthy", database: "connected", timestamp: ISO8601 }`
4. Database connection failure returns `{ status: "unhealthy", database: "disconnected", error: message }` with 503 status code
5. Health check endpoint is publicly accessible (no authentication required)
6. Application deployed to Vercel (preview environment) successfully
7. Health check endpoint accessible at deployed URL and returns "healthy" status
8. Environment variables configured in Vercel (Supabase URL, anon key, service role key for backend)
9. Deployment logs show no errors, build completes in under 3 minutes
10. Vercel deployment URL shared with team for testing

## Tasks / Subtasks

- [x] Create health check API route (AC: 1)
  - [x] Create `/app/api/health/route.ts`
  - [x] Set up GET handler
  - [x] Return JSON response
- [x] Implement database connectivity check (AC: 2, 3, 4)
  - [x] Use Supabase client to execute `SELECT 1` query
  - [x] Handle successful connection
  - [x] Handle connection failures
  - [x] Format appropriate responses
- [x] Ensure public accessibility (AC: 5)
  - [x] Verify no authentication middleware applies
  - [x] Test endpoint without auth
- [ ] Set up Vercel deployment (AC: 6)
  - [ ] Create Vercel account/project if needed
  - [ ] Connect GitHub repository
  - [ ] Configure deployment settings
- [ ] Configure environment variables in Vercel (AC: 8)
  - [ ] Add `NEXT_PUBLIC_SUPABASE_URL`
  - [ ] Add `NEXT_PUBLIC_SUPABASE_ANON_KEY`
  - [ ] Add `SUPABASE_SERVICE_ROLE_KEY` (for server-side operations)
  - [ ] Verify all variables are set correctly
- [ ] Test deployed health check (AC: 7)
  - [ ] Access `/api/health` on deployed URL
  - [ ] Verify response is "healthy"
  - [ ] Check database connection status
- [ ] Review deployment logs (AC: 9)
  - [ ] Check for build errors
  - [ ] Verify build time is under 3 minutes
  - [ ] Ensure clean deployment
- [ ] Share deployment URL (AC: 10)
  - [ ] Document deployment URL
  - [ ] Share with team for testing

## Dev Notes

### Health Check Endpoint Implementation

The health check endpoint should be simple and fast, focusing on critical infrastructure:

```typescript
// app/api/health/route.ts
export async function GET() {
  try {
    // Test database connection
    const { data, error } = await supabase.from("products").select("count");

    if (error) throw error;

    return Response.json({
      status: "healthy",
      database: "connected",
      timestamp: new Date().toISOString(),
    });
  } catch (error) {
    return Response.json(
      {
        status: "unhealthy",
        database: "disconnected",
        error: error.message,
      },
      { status: 503 }
    );
  }
}
```

### Vercel Deployment

**Deployment Steps:**

1. Push code to GitHub repository
2. Create Vercel project
3. Import GitHub repository
4. Configure environment variables
5. Deploy

**Environment Variables Required:**

- `NEXT_PUBLIC_SUPABASE_URL` - Public Supabase project URL
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - Public anon key for client-side
- `SUPABASE_SERVICE_ROLE_KEY` - Service role key for server-side operations

**Build Configuration:**

- Framework Preset: Next.js
- Build Command: `pnpm build` (auto-detected)
- Output Directory: `.next` (auto-detected)
- Install Command: `pnpm install`

### Testing

Manual testing:

- Access health endpoint locally: `http://localhost:3000/api/health`
- Verify response format and database connection
- Test with database disconnected (temporarily invalid credentials)
- Access deployed health endpoint on Vercel
- Verify deployment logs for errors

## Change Log

| Date       | Version | Description            | Author          |
| ---------- | ------- | ---------------------- | --------------- |
| 2026-01-06 | 1.0     | Initial story creation | John (PM Agent) |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5

### Debug Log References

N/A - Aucune erreur rencontrée lors de l'implémentation

### Completion Notes

- Endpoint `/api/health` créé avec succès dans `app/api/health/route.ts`
- Implémentation de la vérification de connexion DB utilisant une requête simple sur la table `products` (équivalent à `SELECT 1`)
- Gestion des erreurs avec réponse 503 pour les échecs de connexion
- Réponses JSON formatées selon les spécifications : `{ status, database, timestamp }` pour healthy, `{ status, database, error }` pour unhealthy
- Vérification que le middleware ne bloque pas l'accès à `/api/health` (le middleware protège uniquement `/dashboard`)
- Le code compile sans erreurs TypeScript
- L'endpoint est accessible publiquement sans authentification requise

**Tâches restantes (déploiement Vercel)** :

- Configuration du déploiement Vercel nécessite une action manuelle (création de compte/projet, connexion GitHub)
- Configuration des variables d'environnement dans Vercel
- Tests sur l'environnement déployé
- Partage de l'URL de déploiement avec l'équipe

### File List

- `partnersllc-app/app/api/health/route.ts` (créé)

## QA Results

_Results from QA Agent review will be documented here._
