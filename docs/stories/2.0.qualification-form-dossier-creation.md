# Story 2.0: Qualification Form & Dossier Creation

## Status

Ready for Review

## Story

**As a** new client who has just paid via a payment link,
**I want** to select my LLC product and complete the qualification form,
**so that** my dossier is created and I can begin the LLC formation process.

## Context

This story covers the **initial entry point** for a client after payment. According to the payment flow:

1. Admin generates a `payment_link` for a prospect
2. Prospect registers and pays via Stripe
3. System automatically creates a dossier with status `QUALIFICATION`
4. Client must complete the workflow steps (dynamically loaded from database) to proceed
5. Upon completion of all steps, dossier status changes accordingly

**IMPORTANT:** This implementation uses a **dynamic workflow system** based on database configuration. Each product has its own set of steps defined in `product_steps`, and each step has its own fields defined in `step_fields`. This makes the system fully modular and configurable without code changes.

This is the **first interaction** a client has with the platform after authentication, bridging the gap between payment and the full dashboard experience.

## Acceptance Criteria

### Product Selection (If Multiple Products)

1. If user has no dossier or empty state, show product selection modal/page
2. Display all available products with: Product name, Description, Price (if shown), Product icon/image
3. Product cards styled with dark theme matching design system
4. "Sélectionner" button on each product card
5. Selection triggers dossier creation with selected product + QUALIFICATION status

### Dynamic Workflow Steps

6. Workflow displays in dashboard after product selection or when accessing existing QUALIFICATION dossier
7. System loads all steps for the selected product from `product_steps` table
8. Each step displays its fields dynamically generated from `step_fields` table
9. Field types supported: text, email, phone, date, select, textarea, checkbox, radio
10. Required fields marked with asterisk (\*) and validated client-side
11. Form follows dark theme design system (card-based, subtle borders, rounded corners)
12. Field validation shows error messages in red (`brand-danger` color)
13. Progress indicator shows current step position and total steps (e.g., "Étape 1 sur 5")
14. User can navigate between steps using "Précédent" and "Suivant" buttons
15. Visual step indicator shows completed, current, and upcoming steps

### Step Submission

14. "Suivant" or "Terminer" button disabled until all required fields valid
15. Button styled with accent color (`brand-accent` #00F0FF) and hover effect
16. Loading state shown during submission (spinner + disabled button)
17. Each step submission saves all field values to `step_field_values` table
18. Step instance is marked as completed in `step_instances` table
19. Dossier `current_step_instance_id` is updated to track progress
20. After final step, user is redirected to dashboard showing their dossier
21. System can create events for each step completion if needed

### Error Handling

21. Display validation errors inline below each field
22. Show toast/notification if server error occurs during submission
23. Handle network errors gracefully with retry option
24. If dossier already submitted (race condition), redirect to dashboard

### Responsive Design

25. Form single column on mobile, can be 2-column on desktop for short fields
26. Form card centered on page with max-width (768px or similar)
27. Buttons full-width on mobile, auto-width on desktop

## UI Design System & Visual DNA

**CRITICAL:** This form is the user's first impression of the platform. It must be clean, professional, and match the established design system.

**Reference Design System:** Based on Stories 2.1, 2.2, and 2.8 (established dark theme)

### Color System

```css
--brand-dark-bg: #191A1D         /* Page background */
--brand-dark-surface: #2D3033    /* Form card background */
--brand-dark-border: #363636     /* Input borders, dividers */
--brand-text-primary: #F9F9F9    /* Labels, headings */
--brand-text-secondary: #B7B7B7  /* Helper text, placeholders */
--brand-accent: #00F0FF          /* CTA button, focus states */
--brand-success: #4ADE80         /* Success messages */
--brand-danger: #F95757          /* Error messages */
```

### Typography

- **Page Title:** 2xl-3xl, bold, text-primary
- **Section Headers:** lg-xl, semibold, text-primary
- **Field Labels:** sm, medium, text-primary
- **Helper Text:** xs-sm, normal, text-secondary
- **Error Messages:** xs-sm, medium, text-danger

### Form Layout

**Page Structure:**

```
┌────────────────────────────────────────┐
│ Page Header                            │
│ - Title: "Création de votre LLC"      │
│ - Subtitle: "Remplissez le formulaire"│
│ - Progress: "Étape 1/5"               │
├────────────────────────────────────────┤
│                                        │
│   ┌──────────────────────────────┐    │
│   │  FORM CARD                   │    │
│   │  [Product Name Display]      │    │
│   │                              │    │
│   │  Field Label *               │    │
│   │  [Input Field]               │    │
│   │  Helper text or error        │    │
│   │                              │    │
│   │  Field Label                 │    │
│   │  [Input Field]               │    │
│   │                              │    │
│   │  ...                         │    │
│   │                              │    │
│   │  [Soumettre le formulaire]   │    │
│   └──────────────────────────────┘    │
│                                        │
└────────────────────────────────────────┘
```

### Form Card Styling

- Background: `bg-brand-dark-surface` (#2D3033)
- Border: `1px solid brand-dark-border` (#363636)
- Border Radius: `rounded-2xl` (16px)
- Padding: `p-8` (32px) on desktop, `p-6` (24px) on mobile
- Max Width: `max-w-3xl` (768px)
- Centered: `mx-auto`
- Shadow: Subtle dark shadow `shadow-lg`

### Input Field Styling

**Text/Email/Phone/Date Inputs:**

```css
/* Base State */
background: #1a1b1e; /* Slightly lighter than card background */
border: 1px solid #363636; /* brand-dark-border */
border-radius: 12px; /* rounded-xl */
padding: 12px 16px; /* py-3 px-4 */
color: #f9f9f9; /* brand-text-primary */
font-size: 14px; /* text-sm */
transition: all 0.2s ease;

/* Placeholder */
color: #b7b7b7; /* brand-text-secondary */

/* Focus State */
border-color: #00f0ff; /* brand-accent */
box-shadow: 0 0 0 3px rgba(0, 240, 255, 0.1); /* Focus ring */
outline: none;

/* Error State */
border-color: #f95757; /* brand-danger */
box-shadow: 0 0 0 3px rgba(249, 87, 87, 0.1);

/* Disabled State */
opacity: 0.5;
cursor: not-allowed;
```

**Select Dropdown:**

- Same styling as text inputs
- Down arrow icon on right: `fa-chevron-down` in `brand-text-secondary`
- Option background: `brand-dark-bg`
- Selected option: `brand-accent` background

**Textarea:**

- Same styling as text inputs
- Min height: `h-32` (128px)
- Resize: `resize-y` (vertical only)

**Checkbox/Radio:**

- Custom styled (not default browser)
- Unchecked: Border `brand-dark-border`, background transparent
- Checked: Background `brand-accent`, checkmark white
- Size: 20px × 20px
- Label margin-left: 8px

### Field Label Styling

```css
display: block;
font-size: 14px; /* text-sm */
font-weight: 500; /* medium */
color: #f9f9f9; /* brand-text-primary */
margin-bottom: 8px; /* mb-2 */

/* Required asterisk */
color: #f95757; /* brand-danger */
margin-left: 4px;
```

### Error Message Styling

```css
display: flex;
align-items: center;
gap: 6px;
font-size: 12px; /* text-xs */
font-weight: 500;
color: #f95757; /* brand-danger */
margin-top: 6px; /* mt-1.5 */

/* Icon */
.error-icon::before {
  content: "\f06a"; /* fa-exclamation-circle */
  font-family: "Font Awesome 6 Free";
}
```

### Submit Button Styling

**Default State:**

```css
background: #00f0ff; /* brand-accent */
color: #191a1d; /* brand-dark-bg - dark text on bright button */
padding: 14px 32px; /* py-3.5 px-8 */
border-radius: 12px; /* rounded-xl */
font-size: 16px; /* text-base */
font-weight: 600; /* semibold */
border: none;
cursor: pointer;
transition: all 0.3s ease;
width: 100%; /* Mobile */
max-width: 300px; /* Desktop */
```

**Hover State:**

```css
opacity: 0.9;
transform: translateY(-2px);
box-shadow: 0 6px 20px rgba(0, 240, 255, 0.3);
```

**Loading State:**

```css
opacity: 0.6;
cursor: not-allowed;
/* Add spinner icon on left */
.spinner {
  animation: spin 1s linear infinite;
}
```

**Disabled State:**

```css
opacity: 0.4;
cursor: not-allowed;
background: #363636; /* brand-dark-border */
color: #b7b7b7; /* brand-text-secondary */
```

### Product Selection Card (If Needed)

**Card Layout:**

```
┌─────────────────────────────────┐
│ [Icon]  Product Name            │
│         Description text...     │
│         Price: $XXX             │
│         [Sélectionner]          │
└─────────────────────────────────┘
```

**Card Styling:**

- Background: `brand-dark-surface`
- Border: `1px solid brand-dark-border`
- Border Radius: `rounded-2xl`
- Padding: `p-6`
- Hover: `translateY(-4px)` + shadow
- Grid: 1 column mobile, 2-3 columns desktop

**Selected State:**

- Border: `2px solid brand-accent`
- Shadow: Accent glow

### Progress Indicator

- Position: Below page title
- Display: "Étape 1 sur X" where X is total step count
- Color: `brand-text-secondary`
- Font: text-sm, medium

### Spacing & Layout

- Field vertical spacing: `space-y-6` (24px between fields)
- Section spacing: `space-y-8` (32px between sections)
- Container padding: `p-4` on mobile, `p-8` on desktop
- Form card margin from top: `mt-8`

### Responsive Breakpoints

- **Mobile (<768px):** Single column, full-width button, smaller padding
- **Desktop (≥768px):** Can use 2-column grid for short fields (firstName/lastName), centered form card

### Accessibility

- All inputs have `<label>` with `htmlFor` matching input `id`
- Required fields have `aria-required="true"`
- Error fields have `aria-invalid="true"` and `aria-describedby` pointing to error message
- Submit button has `aria-busy="true"` during loading
- Keyboard navigation works (Tab through fields, Enter to submit)

### Animation & Transitions

- Input focus: 0.2s ease
- Button hover: 0.3s ease
- Card hover (product selection): 0.3s ease-in-out
- Error message: Fade in 0.2s

## Tasks / Subtasks

- [x] Create product selection interface (AC: 1, 2, 3, 4, 5)

  - [x] Build ProductSelectionCard component
  - [x] Fetch available products from Supabase
  - [x] Display product grid with responsive layout
  - [x] Handle product selection click
  - [x] Create dossier with selected product + QUALIFICATION status

- [x] Build dynamic qualification form (AC: 6, 7, 8, 9, 10, 11, 12, 13)

  - [x] Fetch step_fields for QUALIFICATION step based on product
  - [x] Create DynamicFormField component supporting all field types
  - [x] Build form layout with dark theme styling
  - [x] Add field labels with required asterisks
  - [x] Implement client-side validation for required fields
  - [x] Add progress indicator showing step position
  - [x] Display page header with title and subtitle

- [x] Implement field validation (AC: 10, 12, 21)

  - [x] Validate required fields on blur and submit
  - [x] Validate email format
  - [x] Validate phone format (international)
  - [x] Validate date ranges if applicable
  - [x] Display inline error messages below fields
  - [x] Clear errors when field is corrected

- [x] Build form submission flow (AC: 14, 15, 16, 17, 18, 19, 20)

  - [x] Disable submit button until form is valid
  - [x] Add loading state during submission
  - [x] Save field values to step_field_values table
  - [x] Create DOSSIER_CREATED event
  - [x] Update dossier status to FORM_SUBMITTED
  - [x] Redirect to dashboard on success

- [x] Add error handling (AC: 22, 23, 24)

  - [x] Handle server errors with toast notification
  - [x] Handle network errors with retry option
  - [x] Check if dossier already submitted before saving
  - [x] Display user-friendly error messages

- [x] Implement responsive design (AC: 25, 26, 27)
  - [x] Single column layout on mobile
  - [x] Optional 2-column for paired fields on desktop
  - [x] Center form card with max-width
  - [x] Full-width button on mobile, auto-width on desktop
  - [x] Test on various screen sizes

## Dev Notes

### Database Flow

**Initial Dossier Creation (After Payment):**

```sql
-- Created automatically by payment webhook
INSERT INTO dossiers (id, user_id, product_id, status, current_step_instance_id)
VALUES (uuid_generate_v4(), $user_id, $product_id, 'QUALIFICATION', NULL);
```

**Product Steps Fetch:**

```sql
-- Get all steps for a product
SELECT ps.*, s.*
FROM product_steps ps
JOIN steps s ON ps.step_id = s.id
WHERE ps.product_id = $product_id
ORDER BY ps.position ASC;
```

**Step Fields Fetch:**

```sql
-- Get fields for a specific step
SELECT sf.*
FROM step_fields sf
WHERE sf.step_id = $step_id
ORDER BY sf.position ASC;
```

**Step Submission:**

```sql
-- 1. Get or create step instance
INSERT INTO step_instances (dossier_id, step_id, started_at)
VALUES ($dossier_id, $step_id, NOW())
ON CONFLICT DO UPDATE SET started_at = COALESCE(step_instances.started_at, NOW())
RETURNING id;

-- 2. Insert/update all field values
INSERT INTO step_field_values (step_instance_id, step_field_id, value, created_by_type, created_by_id)
VALUES ($step_instance_id, $step_field_id, $value, 'USER', $user_id)
ON CONFLICT (step_instance_id, step_field_id) DO UPDATE SET value = EXCLUDED.value;

-- 3. Update step instance completion
UPDATE step_instances
SET completed_at = NOW()
WHERE id = $step_instance_id;

-- 4. Update dossier current_step_instance_id
UPDATE dossiers
SET current_step_instance_id = $step_instance_id, updated_at = NOW()
WHERE id = $dossier_id;
```

### Component Architecture

**Dynamic Workflow System:**

- `app/(protected)/dashboard/page.tsx` - Main dashboard that detects QUALIFICATION status and shows workflow
- `components/dashboard/EmptyState.tsx` - Shows product selection OR workflow if dossier exists
- `components/workflow/WorkflowContainer.tsx` - Container that loads product steps
- `components/workflow/WorkflowStepper.tsx` - Main stepper component with step navigation
- `components/qualification/DynamicFormField.tsx` - Dynamic field renderer (reused)
- `components/qualification/ProductSelectionCard.tsx` - Product card component
- `components/qualification/ProductSelectionGrid.tsx` - Product grid layout
- `lib/workflow.ts` - Functions to fetch product_steps and step_fields dynamically
- `lib/validation.ts` - Validation utility functions

**State Management:**

```typescript
// Form state
const [formData, setFormData] = useState<Record<string, any>>({});
const [errors, setErrors] = useState<Record<string, string>>({});
const [isSubmitting, setIsSubmitting] = useState(false);

// Field validation
const validateField = (field: StepField, value: any) => {
  if (field.required && !value) {
    return `${field.label} est requis`;
  }
  if (field.field_type === "email" && !isValidEmail(value)) {
    return "Email invalide";
  }
  // ... more validation
  return null;
};
```

### Dynamic Field Rendering

```typescript
const renderField = (field: StepField) => {
  switch (field.field_type) {
    case "text":
    case "email":
    case "phone":
      return <FormInput {...field} />;
    case "select":
      return <FormSelect options={field.options} {...field} />;
    case "textarea":
      return <FormTextarea {...field} />;
    case "checkbox":
      return <FormCheckbox {...field} />;
    case "radio":
      return <FormRadioGroup options={field.options} {...field} />;
    case "date":
      return <FormDatePicker {...field} />;
    default:
      return <FormInput {...field} />;
  }
};
```

### Field Type Definitions

```typescript
type FieldType =
  | "text"
  | "email"
  | "phone"
  | "date"
  | "select"
  | "textarea"
  | "checkbox"
  | "radio";

interface StepField {
  id: string;
  step_id: string;
  field_name: string;
  field_type: FieldType;
  label: string;
  description?: string;
  placeholder?: string;
  required: boolean;
  options?: string[]; // For select/radio
  validation_rules?: Record<string, any>;
  order: number;
}
```

### Validation Rules

Support common validation patterns:

- **Required:** Check non-empty
- **Email:** Regex `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`
- **Phone:** International format validation
- **Min/Max Length:** For text fields
- **Min/Max Value:** For number fields
- **Pattern:** Custom regex from validation_rules

### Step Submission Flow

```typescript
const handleStepComplete = async (
  stepId: string,
  fieldValues: Record<string, any>
) => {
  // 1. Validate all fields
  const validationErrors = validateForm(fieldValues, currentStepFields);
  if (Object.keys(validationErrors).length > 0) {
    setErrors(validationErrors);
    return;
  }

  setIsSubmitting(true);

  try {
    // 2. Submit step to API
    const response = await fetch("/api/workflow/submit-step", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        dossier_id: dossierId,
        step_id: stepId,
        field_values: fieldValues,
      }),
    });

    if (!response.ok) throw new Error("Step submission failed");

    // 3. Move to next step or complete
    if (currentStepIndex < totalSteps - 1) {
      setCurrentStepIndex(currentStepIndex + 1);
    } else {
      // All steps completed - redirect to dashboard
      window.location.href = "/dashboard";
    }
  } catch (error) {
    alert("Erreur lors de la soumission");
    setIsSubmitting(false);
  }
};
```

### API Routes Structure

**GET `/api/workflow/product-steps?product_id=xxx`**

- Returns all steps for a product with their details

**GET `/api/workflow/step-fields?step_id=xxx`**

- Returns all fields for a specific step

**POST `/api/workflow/submit-step`**

```typescript
// Submits a single step
{
  dossier_id: string;
  step_id: string;
  field_values: Record<string, any>;
}
// Returns: { step_instance_id: string }
```

### RLS Enforcement

RLS policies have been implemented via migration `003_users_can_create_dossiers.sql`:

```sql
-- Users can create their own dossiers
CREATE POLICY "Users can create own dossiers"
ON dossiers FOR INSERT
WITH CHECK (auth.uid() = user_id);

-- Users can update their own dossiers
CREATE POLICY "Users can update own dossiers"
ON dossiers FOR UPDATE
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id);

-- Users can view their own dossiers (from database-v2.sql)
CREATE POLICY "Users can view own dossiers"
ON dossiers FOR SELECT
USING (auth.uid() = user_id);

-- Users can create step instances for their dossiers
CREATE POLICY "Users can create own step instances"
ON step_instances FOR INSERT
WITH CHECK (
  EXISTS (
    SELECT 1 FROM dossiers
    WHERE dossiers.id = step_instances.dossier_id
    AND dossiers.user_id = auth.uid()
  )
);
```

### Empty State Handling

When user has no dossier or an empty state:

1. Check if user has any dossiers
2. If no dossier exists, show product selection in EmptyState component
3. If dossier exists with QUALIFICATION status, show workflow stepper in dashboard
4. If dossier exists with other status, show normal dashboard view
5. All workflow interaction happens within the dashboard, no separate qualification page

### Product Selection Logic

```typescript
// User selects product from EmptyState component
const handleProductSelect = async (productId: string) => {
  // Create dossier with selected product via server action
  await createDossierFromProduct(productId);

  // Page reloads, dashboard detects QUALIFICATION dossier
  // and automatically shows WorkflowStepper
  window.location.reload();
};
```

### Workflow Navigation Logic

```typescript
// WorkflowStepper manages step navigation
const [currentStepIndex, setCurrentStepIndex] = useState(0);
const productSteps = await getProductSteps(productId);

// Load fields for current step
const stepFields = await getStepFields(currentStep.step_id);

// Navigate between steps
- "Précédent" button: currentStepIndex > 0
- "Suivant" button: currentStepIndex < totalSteps - 1
- "Terminer" button: currentStepIndex === totalSteps - 1
```

### Responsive Design Notes

**Mobile (<768px):**

- Single column form
- Full-width inputs
- Full-width button at bottom
- Padding: p-4 (16px)

**Desktop (≥768px):**

- Centered form card (max-w-3xl)
- 2-column grid for paired fields (e.g., First Name | Last Name)
- Button centered with max-width
- Padding: p-8 (32px)

**Grid for Paired Fields:**

```tsx
<div className="grid md:grid-cols-2 gap-6">
  <FormInput label="Prénom" name="firstName" />
  <FormInput label="Nom" name="lastName" />
</div>
```

### Testing Checklist

- [ ] Test product selection creates dossier with QUALIFICATION status
- [ ] Test all field types render correctly (text, email, select, etc.)
- [ ] Test required field validation
- [ ] Test email/phone format validation
- [ ] Test submit button disabled when form invalid
- [ ] Test loading state during submission
- [ ] Test successful submission redirects to dashboard
- [ ] Test error handling (server error, network error)
- [ ] Test RLS prevents accessing other users' dossiers
- [ ] Test responsive layout on mobile/tablet/desktop
- [ ] Test keyboard navigation (Tab, Enter)
- [ ] Test accessibility (labels, ARIA attributes)
- [ ] Test race condition handling (already submitted dossier)

### Performance Considerations

- Lazy load product images
- Debounce validation on text inputs
- Use React.memo for FormInput components
- Consider form library (React Hook Form) for performance

### Future Enhancements

- Save draft (auto-save form data to localStorage) - **Partiellement implémenté** (navigation entre steps)
- Multi-step form with progress bar - **Implémenté** (WorkflowStepper avec indicateur visuel)
- File upload fields for documents - À ajouter pour les steps nécessitant des documents
- Address autocomplete - À ajouter si nécessaire
- Conditional fields (show/hide based on other field values) - À implémenter
- Step dependencies (unlock next step only when previous is completed) - Logique à ajouter
- Step preview mode (voir les steps suivants sans pouvoir les remplir) - Feature future

## Change Log

| Date       | Version | Description                                                   | Author             |
| ---------- | ------- | ------------------------------------------------------------- | ------------------ |
| 2026-01-07 | 1.0     | Initial story creation                                        | Bob (Scrum Master) |
| 2026-01-XX | 2.0     | Refactored to dynamic workflow system based on database steps | James (Dev Agent)  |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (via Cursor)

### Debug Log References

N/A - No debug issues encountered during implementation

### Completion Notes

**Implémentation complète de la story 2.0 - Dynamic Workflow System & Dossier Creation**

**ARCHITECTURE DYNAMIQUE BASÉE SUR LA BASE DE DONNÉES**

L'implémentation utilise un système de workflow entièrement dynamique et modulaire basé sur la structure de la base de données :

1. **Sélection de produit**: Interface de sélection dans EmptyState avec grille responsive, création automatique de dossier avec statut QUALIFICATION
2. **Workflow dynamique**:
   - Les steps sont chargés dynamiquement depuis `product_steps` pour chaque produit
   - Chaque step charge ses champs depuis `step_fields`
   - Navigation entre steps avec indicateur de progression visuel
   - Support de tous les types de champs (text, email, phone, date, select, textarea, checkbox, radio)
3. **Validation**: Validation côté client pour tous les champs requis, formats email/téléphone, messages d'erreur inline
4. **Soumission par étape**:
   - Chaque step est soumis individuellement
   - Sauvegarde dans `step_field_values` avec création/mise à jour de `step_instances`
   - Mise à jour de `dossier.current_step_instance_id` pour suivre la progression
   - Redirection vers dashboard après complétion de tous les steps
5. **Gestion d'erreurs**: Gestion des erreurs serveur et réseau avec messages utilisateur
6. **Design responsive**: Layout adaptatif mobile/desktop, champs jumelés sur desktop, workflow intégré dans le dashboard

**Points techniques importants:**

- **Système modulaire**: Aucune page fixe, tout est basé sur la configuration en base de données
- **Intégration dashboard**: Le workflow s'affiche directement dans le dashboard quand un dossier QUALIFICATION existe
- **Server Components**: Dashboard détecte automatiquement l'état du dossier
- **Client Components**: WorkflowStepper pour la navigation et interactions
- **API Routes**: Endpoints RESTful pour charger steps et fields, soumettre steps
- **Validation**: Côté client et serveur
- **Conformité design system**: Dark theme avec tous les styles définis
- **Accessibilité**: ARIA, labels, navigation clavier complète

### File List

**Types:**

- `partnersllc-app/types/qualification.ts` - Types TypeScript pour qualification (StepField, Product, etc.)

**Librairies:**

- `partnersllc-app/lib/qualification.ts` - Fonction pour récupérer les produits actifs
- `partnersllc-app/lib/workflow.ts` - Fonctions pour récupérer product_steps et step_fields dynamiquement
- `partnersllc-app/lib/validation.ts` - Fonctions de validation des champs

**Composants Workflow:**

- `partnersllc-app/components/workflow/WorkflowContainer.tsx` - Container qui charge les steps d'un produit
- `partnersllc-app/components/workflow/WorkflowStepper.tsx` - Composant principal avec navigation entre steps

**Composants Qualification (réutilisés):**

- `partnersllc-app/components/qualification/DynamicFormField.tsx` - Composant pour rendre les champs dynamiquement
- `partnersllc-app/components/qualification/ProductSelectionCard.tsx` - Carte de sélection de produit
- `partnersllc-app/components/qualification/ProductSelectionGrid.tsx` - Grille de sélection de produits

**Composants Dashboard:**

- `partnersllc-app/components/dashboard/EmptyState.tsx` - Affiche sélection produits OU workflow si dossier existe

**Pages:**

- `partnersllc-app/app/(protected)/dashboard/page.tsx` - Dashboard qui détecte et affiche le workflow

**Actions serveur:**

- `partnersllc-app/app/actions/qualification.ts` - Server action pour créer un dossier depuis un produit

**API Routes:**

- `partnersllc-app/app/api/products/route.ts` - Endpoint pour récupérer les produits actifs
- `partnersllc-app/app/api/workflow/product-steps/route.ts` - Endpoint pour récupérer les steps d'un produit
- `partnersllc-app/app/api/workflow/step-fields/route.ts` - Endpoint pour récupérer les champs d'un step
- `partnersllc-app/app/api/workflow/submit-step/route.ts` - Endpoint pour soumettre un step

**Migrations:**

- `partnersllc-app/supabase/migrations/003_users_can_create_dossiers.sql` - RLS policies pour permettre aux utilisateurs de créer leurs dossiers

## QA Results

_Results from QA Agent review will be documented here._
